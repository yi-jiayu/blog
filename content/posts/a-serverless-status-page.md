---
title: "A Serverless Status Page"
subtitle: "Run health checks from AWS Lambda on a schedule and serve results from S3"
date: 2020-01-09T23:57:24+08:00
tags: ["aws", "terraform", "serverless"]
---

This week, I created a status page for my web properties:
http://status.jiayu.io.s3-website.ap-southeast-1.amazonaws.com/

The page itself and the status history are [served from
S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteHosting.html). They
were generated by [Checkup](https://sourcegraph.github.io/checkup/), a tool for
creating self-hosted status pages. A [scheduled Lambda
function](https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/RunLambdaSchedule.html)
runs Checkup every 5 minutes to perform health checks and stores the results in
S3.

If you're interested, you can check it out and easily deploy it for yourself
using the [Terraform](https://www.terraform.io/) configuration in the GitHub
repository:

{{< linkpreview title="yi-jiayu/status"
description="Serverless status page served from AWS S3 generated by Checkup running in AWS Lambda"
url="https://github.com/yi-jiayu/status" >}}

## Automate from the beginning

I built this with automation and infrastructure as code in mind from the
beginning. The entire stack can be deployed with a single Terraform apply (I
destroyed and reapplied everything from scratch myself to make sure).

Checkup itself does have the ability to help you [provision the S3 bucket it
will
use](https://github.com/sourcegraph/checkup/tree/f47472392057b3cc432fcd426e61f0a56d64c697#setting-up-storage-on-s3),
but it's still an ad-hoc command and requires some manual setup. Another project
I've seen with a similar feature is [plumber](https://www.rplumber.io/), a R
package for creating a web API for R code---it has a function that can [create a
VPS on DigitalOcean and set it up for
you](https://www.rplumber.io/docs/hosting.html#digitalocean) given your
DigitalOcean API key.

I think that going forward, projects that want to provide such automatic
deployment features should use standardised infrastructure as code tools like
Terraform or [Pulumi](https://www.pulumi.com/) rather than implementing it
themselves. 

## Serverless Good, Servers Bad?

Ideally, a serverless status page should make the scenario of your status page
itself going down less likely... right?

Funnily enough, back in 2017 there was an [S3
outage](https://aws.amazon.com/message/41926/) that impacted a handful of other
AWS services---including the AWS status page:

> From the beginning of this event until 11:37AM PST, we were unable to update
> the individual servicesâ€™ status on the AWS Service Health Dashboard (SHD)
> because of a dependency the SHD administration console has on Amazon S3.

Ultimately, I see being serverless as just an interesting property of this
setup at this particular point in time, rather than something to strive towards.

A serverless architecture definitely has its benefits---the Lambda usage for
health checks should be well within the [free
tier](https://aws.amazon.com/lambda/pricing/) and the S3 storage should cost far
less than the typical $5/mo VPS---and works especially well for hobby projects
like this.
